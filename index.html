<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Информационная система поддержки диспансерного наблюдения (ГБ)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f7fa;
      margin: 0;
      padding: 20px;
      color: #1f2937;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    h1 {
      font-size: 22px;
      margin: 0;
    }
    .mode-switch {
      display: flex;
      gap: 8px;
    }
    button {
      padding: 6px 12px;
      border-radius: 6px;
      border: 1px solid #cbd5e1;
      background: white;
      cursor: pointer;
    }
    button.active {
      background: #2563eb;
      color: white;
      border-color: #2563eb;
    }
    .container {
      max-width: 1100px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
    .form-row {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
      align-items: center;
    }
    input {
      padding: 6px;
      width: 90px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      font-size: 14px;
    }
    th, td {
      border: 1px solid #e5e7eb;
      padding: 6px;
      text-align: center;
    }
    th {
      background: #f1f5f9;
    }
    .ok {
      background: #dcfce7;
    }
    .warn {
      background: #fee2e2;
    }
    .actions {
      margin-top: 15px;
      display: flex;
      gap: 10px;
    }
    footer {
      margin-top: 20px;
      font-size: 12px;
      color: #64748b;
    }
  </style>
</head>
<body>
  <header>
    <h1>ИС поддержки диспансерного наблюдения пациентов с ГБ</h1>
    <div class="mode-switch">
      <button id="patientBtn" class="active">Пациент</button>
      <button id="doctorBtn">Врач</button>
    </div>
  </header>

  <div class="container">
    <div class="form-row">
      <label>САД:</label>
      <input id="sbp" type="number" placeholder="120" />
      <label>ДАД:</label>
      <input id="dbp" type="number" placeholder="80" />
      <label>Пульс:</label>
      <input id="pulse" type="number" placeholder="70" />
      <button onclick="addEntry()">Добавить</button>
    </div>

    <table id="bpTable">
      <thead>
        <tr>
          <th>Дата</th>
          <th>САД</th>
          <th>ДАД</th>
          <th>Пульс</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="actions">
      <button onclick="downloadExcel()">Скачать Excel</button>
      <button onclick="downloadPDF()">Скачать PDF</button>
    </div>

    <footer>
      <div id="stats"></div>
      <p>Инструмент предназначен для поддержки диспансерного наблюдения. Не заменяет консультацию врача.</p>
    </footer>
  </div>

<script>
let mode = 'patient';
let data = [];

function normalizeBP(val) {
  return parseInt(val, 10);
}

function switchMode(newMode) {
  mode = newMode;
  document.getElementById('patientBtn').classList.toggle('active', mode==='patient');
  document.getElementById('doctorBtn').classList.toggle('active', mode==='doctor');
}

document.getElementById('patientBtn').onclick = () => switchMode('patient');
document.getElementById('doctorBtn').onclick = () => switchMode('doctor');

function addEntry() {
  const sbp = normalizeBP(document.getElementById('sbp').value);
  const dbp = normalizeBP(document.getElementById('dbp').value);
  const pulse = normalizeBP(document.getElementById('pulse').value);
  if (!sbp || !dbp) return;
  const entry = { date: new Date().toLocaleDateString(), sbp, dbp, pulse };
  data.push(entry);
  render();
}

function render() {
  const tbody = document.querySelector('#bpTable tbody');
  tbody.innerHTML = '';
  data.forEach(e => {
    const tr = document.createElement('tr');
    if (e.sbp < 140 && e.dbp < 90) tr.className = 'ok';
    else tr.className = 'warn';
    tr.innerHTML = `<td>${e.date}</td><td>${e.sbp}</td><td>${e.dbp}</td><td class="${pulseClass(e.pulse)}">${e.pulse}</td>`;
    tbody.appendChild(tr);
  });
  calcStats();
}

function pulseClass(p) {
  if (!p) return '';
  if (p >= 60 && p <= 80) return 'ok';
  return 'warn';
}

function median(arr) {
  const s = [...arr].sort((a,b)=>a-b);
  const m = Math.floor(s.length/2);
  return s.length%2 ? s[m] : (s[m-1]+s[m])/2;
}

function calcStats() {
  if (!data.length) return;
  const sbpArr = data.map(d=>d.sbp);
  const dbpArr = data.map(d=>d.dbp);
  const target = data.filter(d=>d.sbp<140 && d.dbp<90).length;
  document.getElementById('stats').innerText = 
    `Медиана САД: ${median(sbpArr)} | Медиана ДАД: ${median(dbpArr)} | В целевых значениях: ${Math.round(target/data.length*100)}%`;
}

function downloadExcel(){ alert('Экспорт в Excel подключается (xlsx)'); }
function downloadPDF(){ alert('Экспорт в PDF подключается (jsPDF)'); }
</script>
</body>
</html>
